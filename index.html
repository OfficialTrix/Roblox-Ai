<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roblox Blackbox AI â€” Super Edition</title>
<style>
  :root{
    --bg:#0f0f0f; --panel:#121212; --accent:#00ff00; --muted:#9a9a9a; --text:#fff;
  }
  body{margin:0;font-family:Inter,Segoe UI,Arial;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;gap:20px;padding:24px;overflow:hidden}
  /* themes */
  body.theme-neon{--bg:linear-gradient(180deg,#050505,#081008);--panel:rgba(6,6,6,0.85);--accent:#00ff00}
  body.theme-galaxy{--bg:linear-gradient(180deg,#07021a,#0a0822);--panel:rgba(7,7,15,0.8);--accent:#7b66ff}
  body.theme-light{--bg:#f4f7fb;--panel:#ffffff;--accent:#0a9b3a;--text:#0b0b0b;--muted:#666}

  /* container */
  .app{width:100%;max-width:1000px;background:var(--panel);border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 40px rgba(0,0,0,0.6);position:relative}
  header{display:flex;align-items:center;gap:14px}
  .logo{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(0,0,0,0.2));display:flex;align-items:center;justify-content:center;flex-shrink:0;border:1px solid rgba(255,255,255,0.04)}
  .logo svg{width:56px;height:56px}
  h1{font-size:20px;margin:0}
  p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}

  /* grid */
  .main{display:grid;grid-template-columns:1fr 320px;gap:16px;margin-top:14px}
  /* left - chat */
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px;min-height:520px;display:flex;flex-direction:column}
  .chat{flex:1;overflow:auto;padding:12px;border-radius:8px;background:linear-gradient(180deg, rgba(0,0,0,0.2), transparent);box-shadow:inset 0 2px 6px rgba(0,0,0,0.6)}
  .messages{display:flex;flex-direction:column;gap:10px}
  .msg{max-width:78%;padding:10px 12px;border-radius:10px;line-height:1.3;word-wrap:break-word}
  .msg.you{align-self:flex-end;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.03)}
  .msg.ai{align-self:flex-start;background:var(--accent);color:#000;box-shadow:0 6px 20px rgba(0,0,0,0.25)}
  .meta{font-size:12px;color:var(--muted);margin-top:6px}

  .input-row{display:flex;gap:8px;margin-top:12px}
  .input-row input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
  .input-row button{padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}

  /* right - controls */
  .sidebar{display:flex;flex-direction:column;gap:12px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px}
  .avatar{width:80px;height:80px;border-radius:14px;background:linear-gradient(135deg,rgba(255,255,255,0.02),rgba(0,0,0,0.3));display:flex;align-items:center;justify-content:center;margin-bottom:8px}
  .username{font-weight:700}
  .friends{display:flex;flex-direction:column;gap:8px;max-height:160px;overflow:auto;margin-top:8px}
  .friend{display:flex;align-items:center;gap:8px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);justify-content:space-between}
  .theme-row{display:flex;gap:8px}
  .theme-btn{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;text-align:center}
  .small{font-size:13px;color:var(--muted)}

  /* floating controls */
  .top-controls{position:absolute;right:18px;top:14px;display:flex;gap:8px}
  .icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;cursor:pointer}

  /* typing indicator */
  .typing{display:flex;gap:5px;align-items:center}
  .dot{width:8px;height:8px;border-radius:50%;background:rgba(0,0,0,0.2);box-shadow:0 0 6px rgba(255,255,255,0.06);opacity:0.75;animation:blink 1s infinite}
  .dot:nth-child(2){animation-delay:0.15s}
  .dot:nth-child(3){animation-delay:0.3s}
  @keyframes blink{0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2}}

  /* responsive */
  @media (max-width:980px){.main{grid-template-columns:1fr}.sidebar{order:2}.panel{order:1}}
</style>
</head>
<body class="theme-neon">

<div class="app" id="app">
  <header>
    <div class="logo" id="logo">
      <!-- simple avatar SVG -->
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="6" y="6" width="52" height="52" rx="10" fill="black" opacity="0.35"/>
        <path d="M32 12c6.627 0 12 5.373 12 12s-5.373 12-12 12-12-5.373-12-12S25.373 12 32 12z" fill="white" opacity="0.05"/>
        <path d="M20 44c0-6.627 11-6 12-6s12-.627 12 6v2H20v-2z" fill="white" opacity="0.06"/>
        <path d="M32 18a8 8 0 100 16 8 8 0 000-16z" fill="var(--accent)"/>
      </svg>
    </div>
    <div style="flex:1">
      <h1>Roblox Blackbox AI â€” Super Edition</h1>
      <p class="lead">Ask about building, codes, scripting, or Roblox trends â€” now powered by real AI (optional)</p>
    </div>

    <div class="top-controls">
      <button class="icon-btn" id="btnSound" title="Toggle sound">ðŸ”Š</button>
      <button class="icon-btn" id="btnClear" title="Clear chat">ðŸ§¹</button>
    </div>
  </header>

  <div class="main">
    <!-- left: chat panel -->
    <div class="panel">
      <div class="chat" id="chat">
        <div class="messages" id="messages">
          <!-- messages go here -->
        </div>
      </div>

      <div class="input-row">
        <input id="inputMsg" placeholder="Ask something about Roblox... (try 'how to get robux')" />
        <button id="btnSend">Send</button>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <div class="small">AI Model:</div>
        <select id="selectModel" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)">
          <option value="local">Simulated (no server)</option>
          <option value="api">Use Server (OpenAI)</option>
        </select>

        <div style="margin-left:auto" class="small">Roblox Stats: <span id="robloxStat">â€”</span></div>
      </div>
    </div>

    <!-- right: sidebar -->
    <aside class="sidebar">
      <div class="card">
        <div class="avatar" id="avatarWrap">
          <!-- dynamic avatar canvas -->
          <svg id="avatarSVG" width="64" height="64" viewBox="0 0 64 64"><rect width="64" height="64" rx="10" fill="rgba(255,255,255,0.02)"></rect><circle cx="32" cy="26" r="12" fill="var(--accent)"></circle></svg>
        </div>
        <div class="username" id="uiName">Guest</div>
        <div class="small">Saved name & friends in localStorage</div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <input id="inputName" placeholder="Set username" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)" />
          <button id="btnSetName" style="padding:8px;border-radius:8px">Save</button>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Friends</div>
          <button id="btnAddFriend" class="small">+ Add</button>
        </div>
        <div class="friends" id="friendsList">
          <!-- friend entries -->
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="inputFriend" placeholder="Friend's name" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)" />
          <button id="btnSaveFriend">Save</button>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:700">Themes</div>
          <div class="small">Choose</div>
        </div>
        <div class="theme-row">
          <div class="theme-btn" data-theme="theme-neon">Neon</div>
          <div class="theme-btn" data-theme="theme-galaxy">Galaxy</div>
          <div class="theme-btn" data-theme="theme-light">Light</div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Sounds</div>
          <div id="soundStatus" class="small">On</div>
        </div>
        <div class="small" style="margin-top:8px">Send / receive sounds + click UI</div>
      </div>
    </aside>
  </div>
</div>

<!-- sounds -->
<audio id="sndSend" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6788e5c0d7.mp3?filename=click-124467.mp3"></audio>
<audio id="sndRecv" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_c3b70b0fa7.mp3?filename=beep-14771.mp3"></audio>
<audio id="sndClick" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9d3a3e7f80.mp3?filename=small-select-124471.mp3"></audio>

<script>
/* -------------------------
   App State + Helpers
   ------------------------- */
const messagesEl = document.getElementById('messages');
const inputMsg = document.getElementById('inputMsg');
const btnSend = document.getElementById('btnSend');
const sndSend = document.getElementById('sndSend');
const sndRecv = document.getElementById('sndRecv');
const sndClick = document.getElementById('sndClick');
const btnClear = document.getElementById('btnClear');
const btnSound = document.getElementById('btnSound');
const soundStatus = document.getElementById('soundStatus');
const selectModel = document.getElementById('selectModel');
let soundOn = true;
let username = localStorage.getItem('rbx_username') || 'Guest';
document.getElementById('uiName').innerText = username;
document.getElementById('inputName').value = username;

/* load history */
const saved = localStorage.getItem('rbx_chat_history');
if (saved) {
  messagesEl.innerHTML = saved;
  scrollToBottom();
} else {
  // initial message
  addAiMessage(`Hello ${username}! I'm your Roblox Blackbox AI. Ask about games, building, or codes.`);
}

/* save history helper */
function saveHistory() {
  localStorage.setItem('rbx_chat_history', messagesEl.innerHTML);
}

/* message renderers */
function createMsgEl(text, cls) {
  const div = document.createElement('div');
  div.className = 'msg ' + cls;
  div.innerHTML = text;
  return div;
}
function addYouMessage(text) {
  const el = createMsgEl(`<strong>You:</strong> ${escapeHtml(text)}`, 'you');
  messagesEl.appendChild(el);
  scrollToBottom();
  saveHistory();
}
function addAiMessage(text) {
  const el = createMsgEl(`<strong>AI:</strong> ${escapeHtml(text)}`, 'ai');
  messagesEl.appendChild(el);
  scrollToBottom();
  saveHistory();
}

/* typing indicator */
function showTyping() {
  const t = document.createElement('div');
  t.className = 'msg ai';
  t.id = 'typingIndicator';
  t.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div>&nbsp;<span style="opacity:0.8">AI is typing...</span></div>`;
  messagesEl.appendChild(t);
  scrollToBottom();
}
function hideTyping() {
  const t = document.getElementById('typingIndicator');
  if (t) t.remove();
}

/* escape */
function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* scroll */
function scrollToBottom(){ messagesEl.parentElement.scrollTop = messagesEl.parentElement.scrollHeight; }

/* -------------------------
   Send / Receive flow
   ------------------------- */
btnSend.addEventListener('click', onSend);
inputMsg.addEventListener('keypress', (e)=>{ if(e.key==='Enter') onSend(); });

async function onSend(){
  const txt = inputMsg.value.trim();
  if(!txt) return;
  playSound(sndSend);
  addYouMessage(txt);
  inputMsg.value='';

  // show typing
  showTyping();

  // choose path: local simulated or server
  const mode = selectModel.value;
  let aiReply = "";

  try {
    if(mode === 'local'){
      // quick simulated replies
      aiReply = simulatedReply(txt);
      await delay(700);
    } else {
      // send to server endpoint /api/chat
      // build messages (system + user)
      const messages = [
        { role: "system", content: "You are a helpful assistant for Roblox players. Answer succinctly and friendly." },
        { role: "user", content: txt }
      ];

      // call server
      const resp = await fetch('/api/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ messages })
      });

      if(!resp.ok){
        const text = await resp.text();
        aiReply = "Sorry â€” server error: " + text;
      } else {
        const data = await resp.json();
        // depending on OpenAI response shape:
        // Chat Completions: data.choices[0].message.content
        // (we'll check safely)
        if(data?.choices && data.choices[0]?.message?.content){
          aiReply = data.choices[0].message.content.trim();
        } else if (data?.error) {
          aiReply = "API error: " + JSON.stringify(data.error);
        } else {
          aiReply = JSON.stringify(data).slice(0,400);
        }
      }
    }
  } catch (err) {
    aiReply = "Network / server error: " + (err.message || err);
  } finally {
    hideTyping();
    addAiMessage(aiReply);
    playSound(sndRecv);
  }
}

/* small helpers */
function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }
function playSound(a){
  if(!soundOn) return;
  try{ a.currentTime = 0; a.play(); }catch(e){}
}

/* simulated replies (fallback) */
function simulatedReply(msg){
  const m = msg.toLowerCase();
  if(m.includes('robux')) return "You can get Robux by buying them, subscribing to Roblox Premium, or creating content that sells.";
  if(m.includes('how to build') || m.includes('build')) return "Use Roblox Studio â€” start with the 'Baseplate' template and follow the Developer Hub tutorials.";
  if(m.includes('best') && m.includes('game')) return "Popular games: Blox Fruits, BedWars, Doors, Brookhaven, Tower of Hell.";
  if(m.includes('codes')) return "Promo codes change often; check Roblox events and official socials.";
  return "Nice question â€” tell me more or try asking for a tutorial or specific game.";
}

/* -------------------------
   Settings, themes, sounds
   ------------------------- */
document.querySelectorAll('.theme-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.body.classList.remove('theme-neon','theme-galaxy','theme-light');
    document.body.classList.add(btn.dataset.theme);
    playSound(sndClick);
    localStorage.setItem('rbx_theme', btn.dataset.theme);
  });
});
const savedTheme = localStorage.getItem('rbx_theme');
if(savedTheme) document.body.classList.add(savedTheme);

/* save username */
document.getElementById('btnSetName').addEventListener('click', ()=> {
  username = document.getElementById('inputName').value.trim() || 'Guest';
  document.getElementById('uiName').innerText = username;
  localStorage.setItem('rbx_username', username);
  playSound(sndClick);
});

/* clear chat */
btnClear.addEventListener('click', ()=> {
  if(!confirm('Clear chat history?')) return;
  messagesEl.innerHTML = '';
  saveHistory();
  playSound(sndClick);
});

/* toggle sound */
btnSound.addEventListener('click', ()=> {
  soundOn = !soundOn;
  soundStatus.innerText = soundOn ? 'On' : 'Off';
  playSound(sndClick);
});

/* save history periodically */
setInterval(saveHistory, 2500);

/* -------------------------
   Friends list (local)
   ------------------------- */
const friendsListEl = document.getElementById('friendsList');
const inputFriend = document.getElementById('inputFriend');
const btnSaveFriend = document.getElementById('btnSaveFriend');
const btnAddFriend = document.getElementById('btnAddFriend');

function renderFriends(){
  friendsListEl.innerHTML = '';
  const friends = JSON.parse(localStorage.getItem('rbx_friends') || '[]');
  friends.forEach((f, idx)=>{
    const div = document.createElement('div');
    div.className = 'friend';
    div.innerHTML = `<div><strong>${escapeHtml(f.name)}</strong><div class="small">id: ${escapeHtml(f.id||'â€”')}</div></div>
      <div style="display:flex;gap:6px">
        <button onclick="messageFriend(${idx})">Chat</button>
        <button onclick="removeFriend(${idx})">Remove</button>
      </div>`;
    friendsListEl.appendChild(div);
  });
}
function addFriend(name, id){
  const friends = JSON.parse(localStorage.getItem('rbx_friends') || '[]');
  friends.push({ name, id });
  localStorage.setItem('rbx_friends', JSON.stringify(friends));
  renderFriends();
}
function removeFriend(idx){
  const friends = JSON.parse(localStorage.getItem('rbx_friends') || '[]');
  friends.splice(idx,1);
  localStorage.setItem('rbx_friends', JSON.stringify(friends));
  renderFriends();
}
function messageFriend(idx){
  const friends = JSON.parse(localStorage.getItem('rbx_friends') || '[]');
  const f = friends[idx];
  inputMsg.value = `@${f.name} `; inputMsg.focus();
  playSound(sndClick);
}
btnSaveFriend.addEventListener('click', ()=> {
  const name = inputFriend.value.trim();
  if(!name) return alert('Enter friend name');
  addFriend(name, '');
  inputFriend.value='';
  playSound(sndClick);
});
btnAddFriend.addEventListener('click', ()=> {
  document.getElementById('inputFriend').focus();
});
renderFriends();

/* -------------------------
   Roblox Stats (example)
   ------------------------- */
async function fetchRobloxGamePlayers(universeId='0'){
  // Example: this endpoint may have CORS restrictions; if so use your server as proxy.
  // We'll attempt to call a common public endpoint that returns servers/players:
  // Note: This is sample code; adapt universeId to the actual game's universe id.
  try {
    // demo uses games.roblox.com to fetch details
    const url = `https://games.roblox.com/v1/games?universeIds=${encodeURIComponent(universeId)}`;
    const resp = await fetch(url);
    if(!resp.ok) return 'N/A';
    const data = await resp.json();
    if(Array.isArray(data.data) && data.data[0]) {
      const info = data.data[0];
      return `${info.playing ?? 'â€”'} playing`;
    }
    return 'N/A';
  } catch(e){
    return 'N/A';
  }
}
// initial attempt (default: Roblox homepage doesn't have a single universe id â€” replace with real id)
fetchRobloxGamePlayers('0').then(v=>document.getElementById('robloxStat').innerText = v);

/* -------------------------
   Avatar generator (simple)
   ------------------------- */
function generateAvatar(seed){
  // change accent color a bit by seed
  const hue = ((seed && seed.length) || 14) * 13 % 360;
  document.documentElement.style.setProperty('--accent', `hsl(${hue} 90% 50%)`);
}
generateAvatar(username);

/* -------------------------
   Utilities
   ------------------------- */
function loadInitial() {
  // nothing extra
}
loadInitial();

/* expose some functions for friend buttons */
window.removeFriend = removeFriend;
window.messageFriend = messageFriend;
</script>
</body>
          </html>
